version: '2'
services:
  sut:
    depends_on:
      - sshd
    build:
      context: ./tests
      dockerfile: Dockerfile-sut
      args:
        ADD_PACKAGES: make openssh-client
    environment:
      TARGET_HOST: sshd
      TARGET_PORT: 64022
#  ssh-keygen -C 'test-id' -f ./test-rsa -N "" -v
#  cat ./test-rsa | base64 | sed -e ':a;N;$!ba;s/\n//g'
      PRIVATE_KEY_BASE64: "LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUJsd0FBQUFkemMyZ3RjbgpOaEFBQUFBd0VBQVFBQUFZRUFxTENsMGZFMktqVG55aDF6LzFwSDJ1VFA2b3Jsbng3U0xsbzJqenhHTUtZZnlqRXBJN1ExCldIUkJnWU9zeWcyU2xPSGhNYmFqOFNvc2JkZWRFYWNpSzZ3cHRLaWJCSmwzcWN0Z2MyMDc3WWZwWjNWUEo2VVhTb2J5UTgKUFA3M1IxcVJHS0VQUjhub2tSM1BscGM4bzF2RlMxOUtIWkduTnIwY1h4WnQzSysrVG9RRUFJQ0Fqdzh2SFZuczNOb2FKVgpkdXV6VUNXVmdTWU1qNW4ra01hM2ZyMU1MMGQwNWIvbUs2bzdRU3FZY1VNWmhvcW4yU1dYL3BxYURTWU5lNjQwK3lWYzlOCnlTVWtEc1R5R0NwRWlpR09KRkdPNEtTMWtkQlhvU3g0aFlXT0VyYW1OMDkvOXVxS05VYVN0Z1VTQi9ESnNtOFlacjRSbHQKa0orR0o3RWhpWFFRT25KL2hPeTV1SU55WjViQjd3amhqdndrZ0NabFk1NCtJSTViTkZXalNBMXpOSnk4NHdyYWVleWd3QgpxWmVHL215VjdRcEJpSFQ3SGRLOFRTbHhLazNoKzN2MlV5RGxDaG1zajNLWk8rcDI5NFFxZjF0blVtOXcwb2VmRElMSUdzCkRDV0tSWEdLTHRxYVdDOW9qdXJOaG5iaEF2V3owd3hpV1VPM1o3VU5BQUFGZ0xPSzJjMnppdG5OQUFBQUIzTnphQzF5YzIKRUFBQUdCQUtpd3BkSHhOaW8wNThvZGMvOWFSOXJreitxSzVaOGUwaTVhTm84OFJqQ21IOG94S1NPME5WaDBRWUdEck1vTgprcFRoNFRHMm8vRXFMRzNYblJHbklpdXNLYlNvbXdTWmQ2bkxZSE50TysySDZXZDFUeWVsRjBxRzhrUER6KzkwZGFrUmloCkQwZko2SkVkejVhWFBLTmJ4VXRmU2gyUnB6YTlIRjhXYmR5dnZrNkVCQUNBZ0k4UEx4MVo3TnphR2lWWGJyczFBbGxZRW0KREkrWi9wREd0MzY5VEM5SGRPVy81aXVxTzBFcW1IRkRHWWFLcDlrbGwvNmFtZzBtRFh1dU5Qc2xYUFRja2xKQTdFOGhncQpSSW9oamlSUmp1Q2t0WkhRVjZFc2VJV0ZqaEsycGpkUGYvYnFpalZHa3JZRkVnZnd5Ykp2R0dhK0VaYlpDZmhpZXhJWWwwCkVEcHlmNFRzdWJpRGNtZVd3ZThJNFk3OEpJQW1aV09lUGlDT1d6UlZvMGdOY3pTY3ZPTUsybm5zb01BYW1YaHY1c2xlMEsKUVloMCt4M1N2RTBwY1NwTjRmdDc5bE1nNVFvWnJJOXltVHZxZHZlRUtuOWJaMUp2Y05LSG53eUN5QnJBd2xpa1Z4aWk3YQptbGd2YUk3cXpZWjI0UUwxczlNTVlsbER0MmUxRFFBQUFBTUJBQUVBQUFHQVJMUk5sUWd0QzF1bzNBVEs3Y0dUYW0rdXp0ClByV2JkdjJ6a2E1NU9nOHNkMlF4OXFwZ1FMaGc4emJ0QjJXNFRUb3BlczVGYUN4d0pxUGdLSEVsMkQ2VTJoWHRjYzYrNmwKY2g1SEZqdnpJSGN1ZE5pdWVITWczVlhBN2lDZVcrU08xMkV4WGw1MU13eVluZXRuSzZXNzVReUxYeXRjQlEzbFovYTZyeQo2K01ZRzFwaFZ1TC9lVVN4NTc1c1hqYm1WemNZL2w1RXFxYllOVnNsY0IrMjB6NXdhcU5NZGhzUUZMZVpWSHRPN29UNWtJCm1HZDRuVlJXWjNnSUxqckZXdzVFRkduYjc0bWZEb2pUNVV3R1dpSFBSME03b043SDVMMXJldWxnT3lHZkJwbWhDemFKU0gKOHdyNDJLQ25VQjFmemJ3MWFCWS8vVnYwNlhvOVB0QmZKK0VDUFAya2xnK2FjV2xUZFloQnpSVHpCc1hPL2ZlZFZTMDZOUAo4WXZZQmZQTnZ5WnJhdzhNbFI3L0tlNUpuVWp1Zy9QK05JWUhrZWFIdC9KZUl3S05SYUdxdk9aTXRydVJmZFF6VEszMC9ZCit2UTdZWHlneU1PMlVOQkN4UFgxNDVmZXFPUmxuZncxaFhSdWYvOFY2U2hoREIvSW8yN2RvTU9MTEpEWElmYmxPQkFBQUEKd0dGUnNTYUl0ajN1UmovbElBMTBEamkxYlY4c1lZcXpLY2k0Qm1MSndUZ0lDbnQ1ZElLMlp5MjZmMmRBRHZRYmIrNEtUMQpQTm1uWUR6Y0M4TmVKUWR1QldBVytCdSs0REZvMExJVzVCUDRYemxDOW9TUWpBUGJrU3hXT1o3ZGVDVlV2ZmVIS3Z0SEpZCnk2SGFHMTdMTVhwZmVFcndiZ2NCaFRLYVRxR3NmV0VsaHZSZE0wd1ZoL090ZjRoZVdZSEg0N1BJc2J5ekV3UFBiZW1uSzIKVUQvdGt4L25ub2VzNUk0Z3dRSEdWSmt5Mzk5T0tudHpjVTU5NWdhaGlLZTFzbjhBQUFBTUVBMkpzRzluS25TZGRET1J3Zwp6dk51T1hFU1ZqR20vRWhzL0tLMDhIVEVNaFJMMWdzaHpPWUMzZjF0L045MzhVQ2JNQUNIamtiWWc0Z0Z0ZkswOHU1L3M2Cnlzak9QRGQ5Z05FMFIxazBaZ2NnR1VIekdyRXNhbFA5NU14c0EzeFhTTk9uNGVYdFM3eTJWTUYvWDdES0Fmek51and1NXMKNnFIK3dsWjZwTVRJZnFsNUVncGRIcHBsNmN0QkhRSTJCZ204Mzhzc1psT0Q1aE95a3pyN1AzbHpvTVRubmZ1MWc2elY5TwpldGo0MG5CWVJ5Z0U1NEMwa1lQRmdLRGxOenNpZFZBQUFBd1FESFhyYVVjRXpJSGRTdlhHVGh1UUxWZTJBUktvK0w3NEJFCnk1amdkVEY2ZHdUbUxiSzl3aldZai9EYm92MTc3a3hKRXdud0IrUzBWOVVEZjRCdXp4bW9WcU9TVHNCUm1QTWR6ZUFQMTIKZ3A0TW91a2hOd3g5em5NUXJraDZaR0k0amlsMU1pQmp1L3BRNENZc3hwL04vNk0wdmgxb011Nlg1UzN2T3VpOTgwQVNBbAovMlVEeEhjZG1XNGo2cmt6d3FsNUJaZFNCcWpubEExZlBqWjZJbUtWNXp2aXY3SjhqejBKdTUyZ1o1bGlGWVhtN1pDLzlnClFHdkU3R3Z1SFc1dGtBQUFBSGRHVnpkQzFwWkFFQ0F3UT0KLS0tLS1FTkQgT1BFTlNTSCBQUklWQVRFIEtFWS0tLS0tCg=="
    command: tests

  sshd:
    image: ${IMAGE_NAME}
    environment:
      AUTHORIZED_KEYS: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCosKXR8TYqNOfKHXP/Wkfa5M/qiuWfHtIuWjaPPEYwph/KMSkjtDVYdEGBg6zKDZKU4eExtqPxKixt150RpyIrrCm0qJsEmXepy2BzbTvth+lndU8npRdKhvJDw8/vdHWpEYoQ9HyeiRHc+WlzyjW8VLX0odkac2vRxfFm3cr75OhAQAgICPDy8dWezc2holV267NQJZWBJgyPmf6Qxrd+vUwvR3Tlv+YrqjtBKphxQxmGiqfZJZf+mpoNJg17rjT7JVz03JJSQOxPIYKkSKIY4kUY7gpLWR0FehLHiFhY4StqY3T3/26oo1RpK2BRIH8MmybxhmvhGW2Qn4YnsSGJdBA6cn+E7Lm4g3JnlsHvCOGO/CSAJmVjnj4gjls0VaNIDXM0nLzjCtp57KDAGpl4b+bJXtCkGIdPsd0rxNKXEqTeH7e/ZTIOUKGayPcpk76nb3hCp/W2dSb3DSh58MgsgawMJYpFcYou2ppYL2iO6s2GduEC9bPTDGJZQ7dntQ0= test-id"
      SSHD_PORT: 64022
